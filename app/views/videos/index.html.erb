<div class="reel-container">
  <% if @videos.any? %>
    <% @videos.each do |video| %>
      <div class="reel-item">
        <div class="video-content">
          <div class="video-wrapper">
            <% if video.file.present? %>
              <video controls>
                <source src="<%= video.file.url %>" type="video/mp4">
                お使いのブラウザは動画の再生に対応していません。
              </video>
            <% else %>
              <span>動画がありません</span>
            <% end %>
          </div>
          <div class="video-info">
            <div class="user-info">
              <div class="user-avatar">
                <%= image_tag video.user.avatar.url, alt: video.user.name, class: "avatar-image" %>
              </div>
              <p class="user-name"><%= video.user.name %></p>

              <% if current_user == video.user %>
                <div class="video-actions">
                  <%= link_to edit_video_path(video), class: "edit-icon" do %>
                    <i class="fas fa-edit"></i>
                  <% end %>
                  <%= link_to video_path(video), data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, class: "delete-icon" do %>
                    <i class="fas fa-trash-alt"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
            <% if video.ramen_shop.present? %>
              <%= link_to video.ramen_shop.name, ramen_shop_path(video.ramen_shop.id) %>
            <% end %>
              <p class="videos-menu-name">
                <% if video.menu_name.present? %>
                  <strong>メニュー名:</strong> <%= video.menu_name %> 
                  <% if video.price.present? %>
                    <%= video.price %>円
                  <% end %>
                <% end %>
              </p>
              <p class="videos-comment"><%= video.comment if video.comment.present? %></p>
              <div class="video-tags">
                <% video.tags.each do |tag| %>
                  <span class="tag">#<%= tag.name %></span>
                <% end %>
              </div>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class='no-videos-message'>投稿動画がありません</p>
  <% end %>
</div>

<script>
  document.addEventListener('turbo:load', () => {
    const videos = document.querySelectorAll('.reel-item video');
  
    videos.forEach(video => {
      video.addEventListener('play', () => {
        videos.forEach(v => {
          if (v !== video && !v.paused) {
            v.pause();
          }
        });
      });
    });
  });
</script>
